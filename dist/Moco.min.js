function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _get=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(a,b){var c={},d=function(){function a(b,c,d){_classCallCheck(this,a),this.x=b||0,this.y=c||0,this.z=d||0}return _createClass(a,[{key:"distance",value:function(){var a=this.x,b=this.y,c=this.z;return Math.sqrt(a*a+b*b+c*c)}},{key:"multi",value:function(b){if(b instanceof a){var c=b.x,d=b.y,e=b.z;return this.x*c+this.y*d+this.z*e}var f=y=z=b;return this.x*=f,this.y*=y,this.z*=z,this}},{key:"divi",value:function(b){if(b instanceof a){var c=b.x,d=b.y,e=b.z;return this.x/c+this.y/d+this.z/e}var f=d=e=b;return this.x/=f,this.y/=d,this.z/=e,this}},{key:"add",value:function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this}},{key:"sub",value:function(b){var c=a.clone(b);return c.multi(-1),this.add(c),this}},{key:"multiMatrix3",value:function(a){var b=a.getMatrix(),c=this.x,d=this.y,e=this.z;return this.x=c*b[0]+d*b[3]+e*b[6],this.y=c*b[1]+d*b[4]+e*b[7],this.z=c*b[2]+d*b[5]+e*b[8],this}}],[{key:"zero",value:function(){return new a(0,0,0)}},{key:"clone",value:function(b){return new a(b.x,b.y,b.z)}},{key:"angle",value:function(b,c){var d=a.clone(b),e=a.clone(c),f=d.multi(e)/(b.distance()*c.distance());return Math.acos(f)}},{key:"equal",value:function(a,b){return a.x==b.x&&a.y==b.y&&a.z==b.z}},{key:"crossProduct",value:function(b,c){return new a(b.y*c.z-b.z*c.y,b.z*c.x-b.x*c.z,b.x*c.y-b.y*c.x)}},{key:"proj",value:function(b,c){var d=a.clone(c),e=d.distance(),f=d.multi(a.zero().add(b).multi(d)/(e*e));return b.sub(f)}},{key:"norm",value:function(b){var c=a.clone(b),d=c.distance();if(d)return c.multi(1/d);throw new Exception("zero vec3 can't be norm")}}]),a}();c.Vec3=d;var e=function(){function a(b){_classCallCheck(this,a),this._matrix=b||[1,0,0,0,1,0,0,0,1]}return _createClass(a,[{key:"setMatrix",value:function(a){return this._matrix=a,this}},{key:"getMatrix",value:function(){return this._matrix}},{key:"add",value:function(a){var b=a._matrix;return this._matrix[0]+=b[0],this._matrix[1]+=b[1],this._matrix[2]+=b[2],this._matrix[3]+=b[3],this._matrix[4]+=b[4],this._matrix[5]+=b[5],this._matrix[6]+=b[6],this._matrix[7]+=b[7],this._matrix[8]+=b[8],this}},{key:"sub",value:function(a){var b=a._matrix;return this._matrix[0]-=b[0],this._matrix[1]-=b[1],this._matrix[2]-=b[2],this._matrix[3]-=b[3],this._matrix[4]-=b[4],this._matrix[5]-=b[5],this._matrix[6]-=b[6],this._matrix[7]-=b[7],this._matrix[8]-=b[8],this}},{key:"multi",value:function(a){var b=a._matrix,c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];b=this._matrix;var l=b[0],m=b[1],n=b[2],o=b[3],p=b[4],q=b[5],r=b[6],s=b[7],t=b[8];return b[0]=l*c+o*d+r*e,b[1]=m*c+p*d+s*e,b[2]=n*c+q*d+t*e,b[3]=l*f+o*g+r*h,b[4]=m*f+p*g+s*h,b[5]=n*f+q*g+t*h,b[6]=l*i+o*j+r*k,b[7]=m*i+p*j+s*k,b[8]=n*i+q*j+t*k,this}},{key:"translate",value:function(a,b){return this._matrix[6]=a,this._matrix[7]=b,this}},{key:"rotate",value:function(a){var b=Math.cos(a*Math.PI/180),c=Math.sin(a*Math.PI/180);return this._matrix[0]=b,this._matrix[1]=c,this._matrix[3]=-c,this._matrix[4]=b,this}},{key:"scale",value:function(a,b){return this._matrix[0]=a,this._matrix[4]=b,this}}],[{key:"clone",value:function(b){for(var c=b.getMatrix(),d=[],e=0,f=c.length;f>e;e++)d[e]=c[e];return new a(d)}},{key:"copy",value:function(b){var c=a.clone(m2);m1.setMatrix(c.getMatrix())}},{key:"zero",value:function(){return new a([0,0,0,0,0,0,0,0,0])}},{key:"identity",value:function(){return new a([1,0,0,0,1,0,0,0,1])}},{key:"translation",value:function(b,c){return new a([1,0,0,0,1,0,b,c,1])}},{key:"rotation",value:function(b){var c=Math.cos(b*Math.PI/180),d=Math.sin(b*Math.PI/180);return new a([c,d,0,-d,c,0,0,0,1])}},{key:"scaling",value:function(b,c){return new a([b,0,0,0,c,0,0,0,1])}},{key:"transpose",value:function(a){var b=a.getMatrix(),c=null;c=b[1],b[1]=b[3],b[3]=c,c=b[2],b[2]=b[6],b[6]=c,c=b[5],b[5]=b[7],b[7]=c,a.setMatrix(b)}},{key:"inverse",value:function(b){var c=b.getMatrix(),d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8],m=d*h*l+e*i*j+f*g*k-f*h*j-e*g*l-d*i*k,n=(h*l-k*i)/m,o=-(g*l-j*i)/m,p=(g*k-j*h)/m,q=-(e*l-k*f)/m,r=(d*l-j*f)/m,s=-(d*k-j*e)/m,t=(e*i-h*f)/m,u=-(d*i-g*f)/m,v=(d*h-g*e)/m;return c=new a([n,o,p,q,r,s,t,u,v]),a.transpose(c),c}}]),a}();c.Matrix3=e;var f=/\s+/g,g=0,h=Number.MAX_VALUE,j=Number.MIN_VALUE,k=new d(h,h,1),l=new d(j,j,1),m=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"isType",value:function(a,b){return Object.prototype.toString.call(a)=="[object "+b+"]"}},{key:"each",value:function(a,b){var c=this;if(c.isType(a,"Array")&&Array.prototype.forEach)Array.prototype.forEach.call(a,b);else if(c.isType(a,"Array"))for(var d=0,e=a.length;e>d;d++)b(a[d],d,a);else if(c.isType(a,"Object"))for(var f in a)a.hasOwnProperty(f)&&b(a[f],f,a)}},{key:"filter",value:function(a,b){var c=this;if(c.isType(a,"Array")&&Array.prototype.filter)return Array.prototype.filter.call(a,b);var d=function(){var d=[];return c.each(a,function(a,c,e){1==b.call(e,a,c,e)&&d.push(a)}),{v:d}}();return"object"===("undefined"==typeof d?"undefined":_typeof(d))?d.v:void 0}},{key:"map",value:function(a,b){var c=this;if(c.isType(a,"Array")&&Array.prototype.map)return Array.prototype.map.call(a,b);var d=function(){var d=[];return c.each(a,function(a,c,e){d.push(b.call(e,a,c,e))}),{v:d}}();return"object"===("undefined"==typeof d?"undefined":_typeof(d))?d.v:void 0}},{key:"deg2rad",value:function(a){return a*Math.PI/180}},{key:"rad2deg",value:function(a){return a/Math.PI*180}},{key:"keys",value:function b(a){var b=[];if(a){if(Object.keys)return Object.keys(a);for(var c in a)a.hasOwnProperty(c)&&b.push(c)}return b}},{key:"inArray",value:function(a,b,c){for(var d=0,e=b.length;e>d;d++)if("function"==typeof c){if(c.call(a,a,b[d],d,b))return d}else if(b[d]==a)return d;return-1}},{key:"extends",value:function(a){var b=this;if(!b.isType(a,"Object"))return a;for(var c=1,d=arguments.length;d>c;c++){var e=arguments[c];for(var f in e)hasOwnProperty.call(e,f)&&(a[f]=e[f])}return a}},{key:"clone",value:function(a){var b=this;return"object"!=("undefined"==typeof a?"undefined":_typeof(a))?a:b.isType(a,"Array")?Array.prototype.slice.call(a):b["extends"]({},a)}}]),a}();c.Util=m;var n=function(){function b(){_classCallCheck(this,b)}return _createClass(b,null,[{key:"add",value:function(a){var b=this,c=m.inArray(a,b._list,function(a,b){return a.aIndex==b.aIndex});return-1==c&&b._list.push(a),b}},{key:"remove",value:function(a){var b=this,c=m.inArray(a,b._list,function(a,b){return a.aIndex==b.aIndex});return-1!=c&&b._list.splice(c,1),b}},{key:"start",value:function(){var a=this;return a.isStoped=!1,a._isInit||a._init(),a._raf(),a}},{key:"stop",value:function(){var a=this;return a.isStoped=!0,a._isInit||a._init(),a._craf(),a}},{key:"_init",value:function(){for(var b=this,c=0,d=["webkit","moz"],e=a.requestAnimationFrame,f=a.cancelAnimationFrame,g=d.length;--g>=0&&!e;)e=a[d[g]+"RequestAnimationFrame"],f=a[d[g]+"CancelAnimationFrame"];e&&f||(e=function(a){var b=+new Date,d=Math.max(c+16,b);return setTimeout(function(){a(c=d)},d-b)},f=clearTimeout),b._requestAnimationFrame=e,b._cancelAnimationFrame=f,b._isInit=!0}},{key:"_raf",value:function(){var b=this,c=function(){for(var a=b._list,c=0,d=a.length;d>c;c++){var e=a[c];e.tick&&e.tick()}b._raf()};b._timer=b._requestAnimationFrame.call(a,c)}},{key:"_craf",value:function(){var b=this;b._cancelAnimationFrame.call(a,b._timer)}}]),b}();n._list=[],n._isInit=!1,n._timer=null,n._requestAnimationFrame=null,n._cancelAnimationFrame=null,n.isStoped=!1,c.Timer=n;var o=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"getList",value:function(){return m.clone(this._list)}},{key:"add",value:function(a,b){if(b instanceof v){var c=this._list;c[a]=c[a]?c[a]:[];var d=-1==m.inArray(b,c[a],function(a,b){return a.aIndex==b.aIndex});d&&c[a].push(b)}}},{key:"remove",value:function(a,b){if(b instanceof v){var c=this._list;if(c[a]){var d=-1!=m.inArray(b,c[a],function(a,b){return a.aIndex==b.aIndex});d&&c[a].splice(i,1)}}}}]),a}();o._list={},c.InteractiveEvent=o;var p=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,Object.getPrototypeOf(b).apply(this,arguments))}return _inherits(b,a),_createClass(b,null,[{key:"getTopItem",value:function(a,b){var c=this,d=c._list[a]||[];return d=m.filter(d,function(a){return a.isMouseon&&a.isMouseon(b)?!0:void 0}),d=Array.prototype.sort.call(d,function(a,b){for(var c=a.objectIndex.split("."),d=b.objectIndex.split("."),e=Math.max(c.length,d.length),f=0;e>f;f++){if(!d[f]||!c[f])return d[f]?1:-1;if(d[f]!=c[f])return d[f]-c[f]}}),d[0]}}]),b}(o),q={CLICK:"click",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSEMOVE:"mousemove"};for(var r in q)p[r]=q[r];p.nameList=m.keys(q),c.MouseEvent=p;var s=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,Object.getPrototypeOf(b).apply(this,arguments))}return _inherits(b,a),_createClass(b,null,[{key:"getItems",value:function(a){var b=this;return b._list[a]||[]}}]),b}(o),t={KEYDOWN:"keydown",KEYUP:"keyup",KEYPRESS:"keypress"};for(var u in t)s[u]=t[u];s.nameList=m.keys(t),c.KeyboardEvent=s;var v=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"on",value:function(a,b,c,d){var e=this;if("string"==typeof a){var h=[e,a,b,c];a=h[0],b=h[1],c=h[2],d=h[3]}return b&&c&&(d=d?d:!1,m.isType(b,"Array")?m.each(b,function(a){e.on(a,c,d)}):!function(){var h=a.handlers,i=function j(a){for(var c=h[b],d=e._fixEvent(a),f=0,g=c.length;g>f;f++){var i=c[f];if(d.isImmediatePropagationStopped())break;i._guid==j._guid&&i._callback.call(e,d)}};i._fnStr=c._fntStr?c._fnStr:c.toString().replace(f,""),i._callback=c,i._useCapture=d,i._guid=g++,h||(h=a.handlers={}),h[b]||(h[b]=[]),h[b].push(i),h[b].length&&(a.addEventListener?a.addEventListener(b,i,d):a.attachEvent&&a.attachEvent(b,i))}()),e}},{key:"off",value:function(a,b,c){var d=this;if("string"==typeof a){var e=[d,a,b];a=e[0],b=e[1],c=e[2]}if(b||c)if(m.isType(b,"Array"))m.each(b,function(b){d.off(a,b,c)});else if(c){var g=a.handlers;if(g)for(var h=c.fnStr?c.fnStr:c.toString().replace(f,""),i=g[b]?g[b]:[],j=i.length-1;j>=0;j--){var k=i[j];k._fnStr==h&&Array.prototype.splice.call(i,j,1)}}else{var l=a.handlers;if(l){var n=l[b]?l[b]:[];m.each(n,function(c){d.off(a,b,c)})}}return d}},{key:"once",value:function(a,b,c,d){var e=this;if("string"==typeof a){var g=[e,a,b,c];a=g[0],b=g[1],c=g[2],d=g[3]}var h=function i(f){c.call(e,f),f.isImmediatePropagationStopped()&&e.off(a,b,i),d?0==f.eventPhase&&e.off(a,b,i):e.off(a,b,i)};return h._fnStr=c.toString().replace(f,""),e.on(a,b,h,d)}},{key:"trigger",value:function(a,b,c){var d=this;if(a||b){if("string"==typeof a){var e=[d,a,b];a=e[0],b=e[1],c=e[2]}var f=a&&a.handlers;if(!f)return d;var g=f[b]?f[b]:[],h=c||{};null==h.target&&(h.target=h.currentTarget=a),h=d._fixEvent(h);for(var i=a.parent||a.parentNode,j={propagations:[],useCaptures:[]};i;){var k=null;if(k=i.handlers)for(var l=k[b]?k[b]:[],m=0,n=l.length;n>m;m++){var o=l[m]._useCapture;if(o){var p={target:i,callback:l[m]};m?j.useCaptures.splice(1,0,p):j.useCaptures.unshift(p)}else j.propagations.push({target:i,callback:l[m]})}i=i.parent||i.parentNode}var q=j.useCaptures,r=null;h.eventPhase=0;for(var s=0,t=q.length;t>s;s++){var u=q[s];if(a=u.target,h.isImmediatePropagationStopped())break;r==a&&h.isPropagationStopped()?u.callback.call(d,h):(u.callback.call(d,h),r=a)}var v=!1;q.length&&(v=h.isImmediatePropagationStopped()||h.isPropagationStopped()),h.eventPhase=1;for(var w=0,x=g.length;x>w;w++){var y=g[w];if(v)break;y.call(d,h)}var z=j.propagations;r=null,h.eventPhase=2;for(var A=0,B=z.length;B>A;A++){var C=z[A];if(a=C.target,h.target=a,v){if(h.isImmediatePropagationStopped()||h.isPropagationStopped())break;C.callback.call(d,h),r=a}else{if(h.isImmediatePropagationStopped())break;if(h.isPropagationStopped()){if(r!=a)break;C.callback.call(d,h)}else C.callback.call(d,h),r=a}}}}},{key:"_fixEvent",value:function(a){var b=this,c=function(){return!0},d=function(){return!1};return a&&a.isPropagationStopped||!function(){a=a?a:{};var e=a.preventDefault,f=a.stopPropagation,g=a.stopImmediatePropagation;if(a.target||(a.target=a.srcElement||document),a.currentTarget||(a.currentTarget=b),a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement,a.preventDefault=function(){e&&e.call(a),a.returnValue=!1,a.isDefaultPrevented=c,a.defaultPrevented=!0},a.isDefaultPrevented=d,a.defaultPrevented=!1,a.stopPropagation=function(){f&&f.call(a),a.cancelBubble=!0,a.isPropagationStopped=c},a.isPropagationStopped=d,a.stopImmediatePropagation=function(){g&&g.call(a),a.isImmediatePropagationStopped=c,a.stopPropagation()},a.isImmediatePropagationStopped=d,null!=a.clientX){var h=document.documentElement,i=document.body;a.pageX=a.clientX+(h&&h.scrollLeft||i&&i.scrollLeft||0)-(h&&h.clientLeft||i&&i.clientLeft||0),a.pageY=a.clientY+(h&&h.scrollTop||i&&i.scrollTop||0)-(h&&h.clientTop||i&&i.clientTop||0)}a.which=a.charCode||a.keyCode}(),a}}]),a}();c.EventDispatcher=v;var w=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return a.name="DisplayObject",a.alpha=1,a._height=0,a._width=0,a.mask=null,a.rotate=0,a.scaleX=1,a.scaleY=1,a.parent=null,a.globalCompositeOperation="",a.x=0,a.y=0,a.parent=null,a.visible=!0,a.aIndex=a.objectIndex=""+g++,a._isSaved=!1,a._matrix=e.identity(),a._observeOffsetProperty(),a._observeTransformProperty(),a}return _inherits(b,a),_createClass(b,[{key:"show",value:function(a){var b=this,c=b.ctx||b.stage.ctx;if(b._matrix=e.identity(),!b.visible||b.alpha<=.001)return!1;if((null!=b.mask&&b.mask.show||b.alpha<1||0!=b.rotate||1!=b.scaleX||1!=b.scaleY||0!=b.x||0!=b.y||""!=b.globalCompositeOperation)&&(b._isSaved=!0,c.save()),null!=b.mask&&b.mask.show&&(b.mask.show(),c.clip()),b.alpha<1&&(c.globalAlpha=b.alpha>1?1:b.alpha),0!=b.x||0!=b.y){var d=b.x,f=b.y;b._matrix.multi(e.translation(d,f)),c.translate(d,f)}if(0!=b.rotate){var g=b.rotate;b._matrix.multi(e.rotation(g)),c.rotate(m.deg2rad(g))}if(1!=b.scaleX||1!=b.scaleY){var h=b.scaleX,i=b.scaleY;b._matrix.multi(e.scaling(h,i)),c.scale(h,i)}return b._matrix.multi(a),!0}},{key:"dispose",value:function(){var a=this,b=m.keys(a._handlers);a.off(b)}},{key:"_getWidth",value:function(){return this._width}},{key:"_getHeight",value:function(){return this._height}},{key:"_observeOffsetProperty",value:function(){for(var a=this,b=[{key:"width",method:"_getWidth"},{key:"height",method:"_getHeight"}],c=function(c,d){var e=b[d];Object.defineProperty(a,e.key,{get:function(){return a[e.method].call(a)}})},d=0,e=b.length;e>d;d++)c(e,d)}},{key:"_observeTransformProperty",value:function(){for(var a=this,b=[{key:"x",method:"translate",args:function(b){return[b,a.y]}},{key:"y",method:"translate",args:function(b){return[a.x,b]}},{key:"rotate",method:"rotate",args:function(a){return[a]}},{key:"scaleX",method:"scale",args:function(b){return[b,a.scaleY]}},{key:"scaleY",method:"scale",args:function(b){return[a.scaleX,b]}}],c=function(c,d){var e=b[d],f=a[e.key];Object.defineProperty(a,e.key,{set:function(b){f=b,a._matrix[e.method].apply(a._matrix,e.args(b))},get:function(){return f}})},d=0,e=b.length;e>d;d++)c(e,d)}}]),b}(v);c.DisplayObject=w;var x=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return a.name="InteractiveObject",a}return _inherits(b,a),_createClass(b,[{key:"on",value:function(a,c,d){var e=this,f=a.toUpperCase(),g=-1!=m.inArray(f,p.nameList),h=-1!=m.inArray(f,s.nameList);(g||h)&&(g?p.add(a,e):h&&s.add(a,e),_get(Object.getPrototypeOf(b.prototype),"on",this).call(this,a,c,d))}},{key:"off",value:function(a,c){var d=this,e=(a.toUpperCase(),-1!=m.inArray(a,p.nameList)),f=-1!=m.inArray(a,KeyBoardEvent.nameList);(e||f)&&(e?p.remove(a,d):f&&KeyBoardEvent.remove(a,d),_get(Object.getPrototypeOf(b.prototype),"off",this).call(this,a,c))}}]),b}(w);c.InteractiveObject=x;var A=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return a.name="DisplayObjectContainer",a._childList=[],a}return _inherits(b,a),_createClass(b,[{key:"addChild",value:function(a){var b=this;if(a instanceof w){var c=-1==m.inArray(a,b._childList,function(a,b){return a.aIndex==b.aIndex});c&&(a.parent=b,a.stage=a.stage?a.stage:b.stage,a.objectIndex=b.objectIndex+"."+(b._childList.length+1),b._childList.push(a))}}},{key:"removeChild",value:function(a){var b=this;if(a instanceof w)for(var c=b._childList.length-1;c>=0;c--){var d=b._childList[c];if(d.aIndex==a.aIndex){d.parent=null,d.stage=null,Array.prototype.splice.call(b._childList,c,1);break}}}},{key:"getAllChild",value:function(){var a=this;return m.clone(a._childList)}},{key:"getChildAt",value:function(a){var b=this,c=b._childList.length;return Math.abs(a)>c?void 0:(0>a&&(a=c+a),b._childList[a])}},{key:"contains",value:function(a){var b=this;return a instanceof w?-1!=m.inArray(a,b._childList,function(a,b){return a.aIndex==b.aIndex}):void 0}},{key:"show",value:function(a){var c=this;null==a&&(a=e.clone(c._matrix));var d=_get(Object.getPrototypeOf(b.prototype),"show",this).call(this,a);if(d){for(var f=0,g=c._childList.length;g>f;f++){var h=c._childList[f];h.show&&h.show(c._matrix)}if(c._isSaved){var i=c.ctx||c.stage.ctx;c._isSaved=!1,i.restore()}}return d}},{key:"getBounds",value:function(){var a=this,b=a._childList,c=d.clone(k),e=d.clone(l);return m.each(b,function(a){if("function"==typeof a.getBounds){var b=a.getBounds();c.x=b.sv.x<c.x?b.sv.x:c.x,c.y=b.sv.y<c.y?b.sv.y:c.y,e.x=b.ev.x>e.x?b.ev.x:e.x,c.x=b.ev.y>e.y?b.ev.y:e.y}}),c.x!=h&&e.x!=j&&c.y!=h&&e.y!=j||(sx=sy=ex=ey=0),{sv:c,ev:e}}},{key:"_getWidth",value:function(){var a=this,b=a.getBounds();return Math.abs(b.ev.x-b.sv.x)}},{key:"_getHeight",value:function(){var a=this,b=a.getBounds();return Math.abs(b.ev.y-b.sv.y)}}]),b}(x);c.DisplayObjectContainer=A;var B=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));d.name="Stage",d.domElem=document.getElementById(a),d._width=parseFloat(d.domElem.getAttribute("width"),10),d._height=parseFloat(d.domElem.getAttribute("height"),10),d.ctx=d.domElem.getContext("2d");var e=d._getOffset();return d.x=e.left,d.y=e.top,"function"==typeof c&&c(d),d.initialize(),d}return _inherits(b,a),_createClass(b,[{key:"initialize",value:function(){var a=this;m.each(p.nameList,function(b){b=p[b],v.prototype.on.call(a,a.domElem,b,function(b){a._mouseEvent(b)},!1)}),m.each(s.nameList,function(b){b=s[b],v.prototype.on.call(a,document,b,function(b){a._keyboardEvent(b)})},!1),n.add(a),n.start()}},{key:"show",value:function(){var a=this;a.ctx.clearRect(0,0,a._width,a._height),_get(Object.getPrototypeOf(b.prototype),"show",this).call(this)}},{key:"tick",value:function(){var a=this;a.show()}},{key:"addChild",value:function(a){var c=this,d=function(a){a.stage=c,a instanceof C&&a.graphics&&(a.graphics.stage=c,a.graphics.parent=a,a.graphics.objectIndex=a.objectIndex+".0")};if(d(a),a.getAllChild){var e=a.getAllChild();m.each(e,function(a){d(a)})}_get(Object.getPrototypeOf(b.prototype),"addChild",this).call(this,a)}},{key:"isMouseon",value:function(a){return!0}},{key:"_getWidth",value:function(){return this._width}},{key:"_getHeight",value:function(){return this._height}},{key:"_mouseEvent",value:function(a){var b=this,c={x:0,y:0};null!=a.clientX&&(c.x=a.pageX-b.x,c.y=a.pageY-b.y),a.cord=c;var d=a.type,e=p.getTopItem(d,c);e&&e.trigger(d,a)}},{key:"_keyboardEvent",value:function(a){var b=a.type,c=s.getItems(b);c.length&&m.each(c,function(c){c.trigger(b,a)})}},{key:"_getOffset",value:function(){return{top:0,left:0}}}]),b}(A);c.Stage=B;var C=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return a.name="Sprite",a.graphics=null,a}return _inherits(b,a),_createClass(b,[{key:"addChild",value:function(a){a instanceof D||_get(Object.getPrototypeOf(b.prototype),"addChild",this).call(this,a)}},{key:"removeChild",value:function(a){a instanceof D||_get(Object.getPrototypeOf(b.prototype),"removeChild",this).call(this,a)}},{key:"show",value:function(a){var c=this,d=_get(Object.getPrototypeOf(b.prototype),"show",this).call(this,a);if(d&&(c.graphics&&c.graphics.show&&(w.prototype.show.call(c,a),c.graphics.show(c._matrix)),c._isSaved)){var e=c.ctx||c.stage.ctx;c._isSaved=!1,e.restore()}return d}},{key:"isMouseon",value:function(a){return!0}},{key:"_getWidth",value:function(){var a=this,c=_get(Object.getPrototypeOf(b.prototype),"getBounds",this).call(this),d=null;a.graphics instanceof D&&(d=a.graphics.getBounds()),d&&(c.sv.x=c.sv.x<d.sv.x?c.sv.x:d.sv.x,c.ev.x=c.ev.x>d.ev.x?c.ev.x:d.ev.x);var e=Math.abs(c.ev.x-c.sv.x);return Number.isNaN(e)?0:e}},{key:"_getHeight",value:function(){var a=this,c=_get(Object.getPrototypeOf(b.prototype),"getBounds",this).call(this),d=null;a.graphics instanceof D&&(d=a.graphics.getBounds()),d&&(c.sv.y=c.sv.y<d.sv.y?c.sv.y:d.sv.y,c.ev.y=c.ev.y>d.ev.y?c.ev.y:d.ev.y);var e=Math.abs(c.ev.y-c.sv.y);return Number.isNaN(e)?0:e}}]),b}(A);c.Sprite=C;var D=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return a.name="Shape",a._showList=[],a._setList=[],a}return _inherits(b,a),_createClass(b,[{key:"on",value:function(){}},{key:"off",value:function(){}},{key:"show",value:function(a){var c=this,d=c._showList,e=_get(Object.getPrototypeOf(b.prototype),"show",this).call(this,a);if(e){for(var f=0,g=d.length;g>f;f++){var h=d[f];"function"==typeof h&&h()}if(c._isSaved){var i=c.ctx||c.stage.ctx;c._isSaved=!1,i.restore()}}return e}},{key:"lineWidth",value:function(a){var b=this;b._showList.push(function(){var c=b.ctx||b.stage.ctx;c.lineWidth=a})}},{key:"strokeStyle",value:function(a){var b=this;b._showList.push(function(){var c=b.ctx||b.stage.ctx;c.strokeStyle=a})}},{key:"stroke",value:function(){var a=this;a._showList.push(function(){var b=a.ctx||a.stage.ctx;b.stroke()})}},{key:"beginPath",value:function(){var a=this;a._showList.push(function(){var b=a.ctx||a.stage.ctx;b.beginPath()})}},{key:"closePath",value:function(){var a=this;a._showList.push(function(){var b=a.ctx||a.stage.ctx;b.closePath()})}},{key:"moveTo",value:function(a,b){var c=this;c._showList.push(function(){var d=c.ctx||c.stage.ctx;d.moveTo(a,b)})}},{key:"lineTo",value:function(a,b){var c=this;c._showList.push(function(){var d=c.ctx||c.stage.ctx;d.lineTo(a,b)})}},{key:"clear",value:function(){var a=this;a._showList=[],a._setList=[]}},{key:"rect",value:function(a,b,c,d){var e=this;e._showList.push(function(){e.ctx||e.stage.ctx;e.stage.ctx.rect(a,b,c,d)}),e._setList.push({type:"rect",area:[a,b,c,d]})}},{key:"fillStyle",value:function(a){var b=this;b._showList.push(function(){var c=b.ctx||b.stage.ctx;c.fillStyle=a})}},{key:"fill",value:function(){var a=this;a._showList.push(function(){var b=a.ctx||a.stage.ctx;b.fill()})}},{key:"arc",value:function(a,b,c,d,e,f){var g=this;g._showList.push(function(){var h=g.ctx||g.stage.ctx;h.arc(a,b,c,d,e,f)}),g._setList.push({type:"arc",area:[a,b,c,d,e,f]})}},{key:"drawArc",value:function(a,b,c,d,e){var f=this;f._showList.push(function(){var g=f.ctx||f.stage.ctx;g.beginPath(),g.arc(c[0],c[1],c[2],c[3],c[4],c[5]),d&&(g.fillStyle=e,g.fill()),g.lineWidth=a,g.strokeStyle=b,g.stroke()}),f._setList.push({type:"arc",area:c})}},{key:"drawRect",value:function(a,b,c,d,e){var f=this;f._showList.push(function(){var g=f.ctx||f.stage.ctx;g.beginPath(),g.rect(c[0],c[1],c[2],c[3]),d&&(g.fillStyle=e,g.fill()),g.lineWidth=a,g.strokeStyle=b,g.stroke()}),f._setList.push({type:"rect",area:c})}},{key:"drawVertices",value:function(a,b,c,d,e){var f=this,g=c.length;3>g||(f._showList.push(function(){var h=f.ctx||f.stage.ctx;for(h.beginPath(),h.moveTo(c[0][0],c[0][1]),i=1;i<g;i++){var j=c[i];h.lineTo(j[0],j[1])}h.lineTo(c[0][0],c[0][1]),d&&(h.fillStyle=e,h.fill()),h.lineWidth=a,h.strokeStyle=b,h.closePath(),h.stroke()}),f._setList.push({type:"vertices",area:c}))}},{key:"drawLine",value:function(a,b,c){var d=this;d._showList.push(function(){var e=d.ctx||d.stage.ctx;e.beginPath(),e.moveTo(c[0],c[1]),e.lineTo(c[2],c[3]),e.lineWidth=a,e.strokeStyle=b,e.closePath(),e.stroke()})}},{key:"lineStyle",value:function(a,b,c){var d=this;c&&(d.alpha=c),d._showList.push(function(){var c=d.ctx||d.stage.ctx;c.lineWidth=a,c.strokeStyle=b})}},{key:"add",value:function(a){var b=this;b._showList.push(function(){a.call(b)})}},{key:"isMouseon",value:function(a){return!1}},{key:"getBounds",value:function(){for(var a=this,b=a._setList,c=h,e=j,f=h,g=j,i=0,k=b.length;k>i;i++){var l=b[i],n=l.area,o={};switch(l.type){case"rect":n=[[n[0],n[1]],[n[0]+n[2],n[1]],[n[0]+n[2],n[1]+n[3]],[n[0],n[1]+n[3]]];case"vertices":o=a._computeVerticeMinRect(n);break;case"arc":o=a._computeArcMinRect.apply(a,n)}var p=m.map(o,function(b){return b.multiMatrix3(a._matrix)});m.each(p,function(a){c=a.x<c?a.x:c,e=a.x>e?a.x:e,f=a.y<f?a.y:f,g=a.y>g?a.y:g})}return c!=h&&e!=j&&f!=h&&g!=j||(c=f=e=g=0),{sv:new d(c,f,1),ev:new d(e,g,1)}}},{key:"_getWidth",value:function(){var a=this,b=a.getBounds();return Math.abs(b.ev.x-b.sv.x)}},{key:"_getHeight",value:function(){var a=this,b=a.getBounds();return Math.abs(b.ev.y-b.sv.y)}},{key:"_computeArcMinRect",value:function(a,b,c,f,g,h){var i=0,j=0,k=0,l=0;if(f=m.rad2deg(f),g=m.rad2deg(g),Math.abs(g-f)/360>=1)return{s1v:new d(a-c,b-c,1),s2v:new d(a+c,b-c,1),e1v:new d(a-c,b+c,1),e2v:new d(a+c,b+c,1)};if(f-=360*Math.floor(f/360),g-=360*Math.floor(g/360),h){var n=[g,f];f=n[0],g=n[1]}var o=0;180>f&&f>=90?o=90:270>f&&f>=180?o=180:360>f&&f>=270&&(o=270),f-=o,g-=o,f=0>f?f+360:f,g=0>g?g+360:g;var p=Math.sin,q=Math.cos,r=d.zero(),s=d.zero();if(90>g&&g>f){var t=m.deg2rad(f),u=m.deg2rad(g);r=new d(q(u)*c,p(t)*c,1),s=new d(q(t)*c,p(u)*c,1)}else if(90>g&&f>g)r=new d(-c,-c,1),s=new d(c,c,1);else if(180>g&&g>=90){var v=m.deg2rad(Math.min(180-g,f)),w=m.deg2rad(f),x=m.deg2rad(180-g);r=new d(-q(x)*c,p(v)*c,1),s=new d(q(w)*c,c,1)}else if(270>g&&g>=180){var y=m.deg2rad(f),z=m.deg2rad(g-180);r=new d(-c,-p(z)*c,1),s=new d(q(y)*c,c,1)}else if(360>g&&g>=270){var A=m.deg2rad(Math.min(360-g,f));r=new d(-c,-c,1),s=new d(q(A)*c,c,1)}var B=e.translation(a,b),C=e.rotation(o),D=B.multi(C);return r.multiMatrix3(D),s.multiMatrix3(D),r.x<s.x?(i=r.x,k=s.x):(i=s.x,k=r.x),r.y<s.y?(j=r.y,l=s.y):(j=s.y,l=r.y),{s1v:new d(i,j,1),s2v:new d(k,j,1),e1v:new d(i,l,1),e2v:new d(k,l,1)}}},{key:"_computeVerticeMinRect",value:function(a){for(var b=0,c=0,e=0,f=0,g=0,h=a.length;h>g;g++){var i=a[g];b=b<i[0]?b:i[0],c=c<i[1]?c:i[1],e=e>i[0]?e:i[0],f=f>i[1]?f:f[0]}return{s1v:new d(b,c,1),s2v:new d(e,c,1),e1v:new d(b,f,1),e2v:new d(e,f,1)}}}]),b}(w);c.Shape=D,a.Moco=c}(window,void 0);