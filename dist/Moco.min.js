function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _get=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(a,b){var c={},d=/\s+/g,e=0,f=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"isType",value:function(a,b){return Object.prototype.toString.call(a)=="[object "+b+"]"}},{key:"each",value:function(a,b){if(a&&Array.prototype.forEach)Array.prototype.forEach.call(a,b);else if(this.isType("Array",a))for(var c=0,d=a.length;d>c;c++)b(a[c],c,a)}},{key:"filter",value:function(a,b){var c=this;if(a&&Array.prototype.filter)return Array.prototype.filter.call(a,b);var d=function(){var d=[];return c.each(a,function(a,c,e){1==b.call(e,a,c,e)&&d.push(a)}),{v:d}}();return"object"===("undefined"==typeof d?"undefined":_typeof(d))?d.v:void 0}},{key:"deg2rad",value:function(a){return a*Math.PI/180}},{key:"keys",value:function b(a){var b=[];if(a){if(Object.keys)return Object.keys(a);for(var c in a)a.hasOwnProperty(c)&&b.push(c)}return b}},{key:"inArray",value:function(a,b,c){for(var d=0,e=b.length;e>d;d++)if("function"==typeof c){if(c.call(a,a,b[d],d,b))return d}else if(b[d]==a)return d;return-1}},{key:"extends",value:function(a){var b=this;if(!b.isType(a,"Object"))return a;for(var c=1,d=arguments.length;d>c;c++){var e=arguments[c];for(var f in e)hasOwnProperty.call(e,f)&&(a[f]=e[f])}return a}},{key:"clone",value:function(a){var b=this;return"object"!=("undefined"==typeof a?"undefined":_typeof(a))?a:b.isType(a,"Array")?Array.prototype.slice.call(a):b["extends"]({},a)}}]),a}();c.Util=f;var g=function(){function b(){_classCallCheck(this,b)}return _createClass(b,null,[{key:"add",value:function(a){var b=this,c=f.inArray(a,b._list,function(a,b){return a.aIndex==b.aIndex});return-1==c&&b._list.push(a),b}},{key:"remove",value:function(a){var b=this,c=f.inArray(a,b._list,function(a,b){return a.aIndex==b.aIndex});return-1!=c&&b._list.splice(c,1),b}},{key:"start",value:function(){var a=this;return a.isStoped=!1,a._isInit||a._init(),a._raf(),a}},{key:"stop",value:function(){var a=this;return a.isStoped=!0,a._isInit||a._init(),a._craf(),a}},{key:"_init",value:function(){for(var b=this,c=0,d=["webkit","moz"],e=a.requestAnimationFrame,f=a.cancelAnimationFrame,g=d.length;--g>=0&&!e;)e=a[d[g]+"RequestAnimationFrame"],f=a[d[g]+"CancelAnimationFrame"];e&&f||(e=function(a){var b=+new Date,d=Math.max(c+16,b);return setTimeout(function(){a(c=d)},d-b)},f=clearTimeout),b._requestAnimationFrame=e,b._cancelAnimationFrame=f,b._isInit=!0}},{key:"_raf",value:function(){var b=this,c=function(){for(var a=b._list,c=0,d=a.length;d>c;c++){var e=a[c];e.tick&&e.tick()}b._raf()};b._timer=b._requestAnimationFrame.call(a,c)}},{key:"_craf",value:function(){var b=this;b._cancelAnimationFrame.call(a,b._timer)}}]),b}();g._list=[],g._isInit=!1,g._timer=null,g._requestAnimationFrame=null,g._cancelAnimationFrame=null,g.isStoped=!1,c.Timer=g;var h=function(){function a(b,c,d){_classCallCheck(this,a),this.x=b||0,this.y=c||0,this.z=d||0}return _createClass(a,[{key:"distance",value:function(){var a=this.x,b=this.y,c=this.z;return Math.sqrt(a*a+b*b+c*c)}},{key:"multi",value:function(b){if(b instanceof a){var c=b.x,d=b.y,e=b.z;return this.x*c+this.y*d+this.z*e}var f=y=z=b;return this.x*=f,this.y*=y,this.z*=z,this}},{key:"divi",value:function(b){if(b instanceof a){var c=b.x,d=b.y,e=b.z;return this.x/c+this.y/d+this.z/e}var f=d=e=b;return this.x/=f,this.y/=d,this.z/=e,this}},{key:"add",value:function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this}},{key:"sub",value:function(b){var c=a.clone(b);return c.multi(-1),this.add(c),this}},{key:"multiMatrix3",value:function(a){var b=a.getMatrix(),c=this.x,d=this.y,e=this.z;return this.x=c*b[0]+d*b[3]+e*b[6],this.y=c*b[1]+d*b[4]+e*b[7],this.z=c*b[2]+d*b[5]+e*b[8],this}}],[{key:"zero",value:function(){return new a(0,0,0)}},{key:"clone",value:function(b){return new a(b.x,b.y,b.z)}},{key:"angle",value:function(b,c){var d=a.clone(b),e=a.clone(c),f=d.multi(e)/(b.distance()*c.distance());return Math.acos(f)}},{key:"equal",value:function(a,b){return a.x==b.x&&a.y==b.y&&a.z==b.z}},{key:"crossProduct",value:function(b,c){return new a(b.y*c.z-b.z*c.y,b.z*c.x-b.x*c.z,b.x*c.y-b.y*c.x)}},{key:"proj",value:function(b,c){var d=a.clone(c),e=d.distance(),f=d.multi(a.zero().add(b).multi(d)/(e*e));return b.sub(f)}},{key:"norm",value:function(b){var c=a.clone(b),d=c.distance();if(d)return c.multi(1/d);throw new Exception("zero vec3 can't be norm")}}]),a}();c.Vec3=h;var j=function(){function a(b){_classCallCheck(this,a),this._matrix=b||[1,0,0,0,1,0,0,0,1]}return _createClass(a,[{key:"setMatrix",value:function(a){return this._matrix=a,this}},{key:"getMatrix",value:function(){return this._matrix}},{key:"add",value:function(a){var b=a._matrix;return this._matrix[0]+=b[0],this._matrix[1]+=b[1],this._matrix[2]+=b[2],this._matrix[3]+=b[3],this._matrix[4]+=b[4],this._matrix[5]+=b[5],this._matrix[6]+=b[6],this._matrix[7]+=b[7],this._matrix[8]+=b[8],this}},{key:"sub",value:function(a){var b=a._matrix;return this._matrix[0]-=b[0],this._matrix[1]-=b[1],this._matrix[2]-=b[2],this._matrix[3]-=b[3],this._matrix[4]-=b[4],this._matrix[5]-=b[5],this._matrix[6]-=b[6],this._matrix[7]-=b[7],this._matrix[8]-=b[8],this}},{key:"multi",value:function(a){var b=a._matrix,c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];b=this._matrix;var l=b[0],m=b[1],n=b[2],o=b[3],p=b[4],q=b[5],r=b[6],s=b[7],t=b[8];return b[0]=l*c+o*d+r*e,b[1]=m*c+p*d+s*e,b[2]=n*c+q*d+t*e,b[3]=l*f+o*g+r*h,b[4]=m*f+p*g+s*h,b[5]=n*f+q*g+t*h,b[6]=l*i+o*j+r*k,b[7]=m*i+p*j+s*k,b[8]=n*i+q*j+t*k,this}},{key:"translate",value:function(a,b){return this._matrix[6]=a,this._matrix[7]=b,this}},{key:"rotate",value:function(a){var b=Math.cos(a*Math.PI/180),c=Math.sin(a*Math.PI/180);return this._matrix[0]=b,this._matrix[1]=c,this._matrix[3]=-c,this._matrix[4]=b,this}},{key:"scale",value:function(a,b){return this._matrix[0]=a,this._matrix[4]=b,this}}],[{key:"clone",value:function(b){for(var c=b.getMatrix(),d=[],e=0,f=c.length;f>e;e++)d[e]=c[e];return new a(d)}},{key:"copy",value:function(b){var c=a.clone(m2);m1.setMatrix(c.getMatrix())}},{key:"zero",value:function(){return new a([0,0,0,0,0,0,0,0,0])}},{key:"identity",value:function(){return new a([1,0,0,0,1,0,0,0,1])}},{key:"translation",value:function(b,c){return new a([1,0,0,0,1,0,b,c,1])}},{key:"rotation",value:function(b){var c=Math.cos(b*Math.PI/180),d=Math.sin(b*Math.PI/180);return new a([c,d,0,-d,c,0,0,0,1])}},{key:"scaling",value:function(b,c){return new a([b,0,0,0,c,0,0,0,1])}},{key:"transpose",value:function(a){var b=a.getMatrix(),c=null;c=b[1],b[1]=b[3],b[3]=c,c=b[2],b[2]=b[6],b[6]=c,c=b[5],b[5]=b[7],b[7]=c,a.setMatrix(b)}},{key:"inverse",value:function(b){var c=b.getMatrix(),d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8],m=d*h*l+e*i*j+f*g*k-f*h*j-e*g*l-d*i*k,n=(h*l-k*i)/m,o=-(g*l-j*i)/m,p=(g*k-j*h)/m,q=-(e*l-k*f)/m,r=(d*l-j*f)/m,s=-(d*k-j*e)/m,t=(e*i-h*f)/m,u=-(d*i-g*f)/m,v=(d*h-g*e)/m;return c=new a([n,o,p,q,r,s,t,u,v]),a.transpose(c),c}}]),a}();c.Matrix3=j;var k=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"getList",value:function(){return f.clone(this._list)}},{key:"add",value:function(a,b){if(b instanceof r){var c=this._list;c[a]=c[a]?c[a]:[];var d=-1==f.inArray(b,c[a],function(a,b){return a.aIndex==b.aIndex});d&&c[a].push(b)}}},{key:"remove",value:function(a,b){if(b instanceof r){var c=this._list;if(c[a]){var d=-1!=f.inArray(b,c[a],function(a,b){return a.aIndex==b.aIndex});d&&c[a].splice(i,1)}}}}]),a}();k._list={},c.InteractiveEvent=k;var l=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,Object.getPrototypeOf(b).apply(this,arguments))}return _inherits(b,a),_createClass(b,null,[{key:"getTopItem",value:function(a,b){var c=this,d=c._list[a]||[];return d=f.filter(d,function(a){return a.isMouseon&&a.isMouseon(b)?!0:void 0}),d=Array.prototype.sort.call(d,function(a,b){for(var c=a.objectIndex.split("."),d=b.objectIndex.split("."),e=Math.max(c.length,d.length),f=0;e>f;f++){if(!d[f]||!c[f])return d[f]?1:-1;if(d[f]!=c[f])return d[f]-c[f]}}),d[0]}}]),b}(k),m={CLICK:"click",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSEMOVE:"mousemove"};for(var n in m)l[n]=m[n];l.nameList=f.keys(m),c.MouseEvent=l;var o=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,Object.getPrototypeOf(b).apply(this,arguments))}return _inherits(b,a),_createClass(b,null,[{key:"getItems",value:function(a){var b=this;return b._list[a]||[]}}]),b}(k),p={KEYDOWN:"keydown",KEYUP:"keyup",KEYPRESS:"keypress"};for(var q in p)o[q]=p[q];o.nameList=f.keys(p),c.KeyboardEvent=o;var r=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"on",value:function(a,b,c,g){var h=this;if("string"==typeof a){var i=[h,a,b,c];a=i[0],b=i[1],c=i[2],g=i[3]}return b&&c&&(g=g?g:!1,f.isType(b,"Array")?f.each(b,function(a){h.on(a,c,g)}):!function(){var f=a.handlers,i=function j(a){for(var c=f[b],d=h._fixEvent(a),e=0,g=c.length;g>e;e++){var i=c[e];if(d.isImmediatePropagationStopped())break;i._guid==j._guid&&i._callback.call(h,d)}};i._fnStr=c._fntStr?c._fnStr:c.toString().replace(d,""),i._callback=c,i._useCapture=g,i._guid=e++,f||(f=a.handlers={}),f[b]||(f[b]=[]),f[b].push(i),f[b].length&&(a.addEventListener?a.addEventListener(b,i,g):a.attachEvent&&a.attachEvent(b,i))}()),h}},{key:"off",value:function(a,b,c){var e=this;if("string"==typeof a){var g=[e,a,b];a=g[0],b=g[1],c=g[2]}if(b||c)if(f.isType(b,"Array"))f.each(b,function(b){e.off(a,b,c)});else if(c){var h=a.handlers;if(h)for(var i=c.fnStr?c.fnStr:c.toString().replace(d,""),j=h[b]?h[b]:[],k=j.length-1;k>=0;k--){var l=j[k];l._fnStr==i&&Array.prototype.splice.call(j,k,1)}}else{var m=a.handlers;if(m){var n=m[b]?m[b]:[];f.each(n,function(c){e.off(a,b,c)})}}return e}},{key:"once",value:function(a,b,c,e){var f=this;if("string"==typeof a){var g=[f,a,b,c];a=g[0],b=g[1],c=g[2],e=g[3]}var h=function i(d){c.call(f,d),d.isImmediatePropagationStopped()&&f.off(a,b,i),e?0==d.eventPhase&&f.off(a,b,i):f.off(a,b,i)};return h._fnStr=c.toString().replace(d,""),f.on(a,b,h,e)}},{key:"trigger",value:function(a,b,c){var d=this;if(a||b){if("string"==typeof a){var e=[d,a,b];a=e[0],b=e[1],c=e[2]}var f=a&&a.handlers;if(!f)return d;var g=f[b]?f[b]:[],h=c||{};null==h.target&&(h.target=h.currentTarget=a),h=d._fixEvent(h);for(var i=a.parent||a.parentNode,j={propagations:[],useCaptures:[]};i;){var k=null;if(k=i.handlers)for(var l=k[b]?k[b]:[],m=0,n=l.length;n>m;m++){var o=l[m]._useCapture;if(o){var p={target:i,callback:l[m]};m?j.useCaptures.splice(1,0,p):j.useCaptures.unshift(p)}else j.propagations.push({target:i,callback:l[m]})}i=i.parent||i.parentNode}var q=j.useCaptures,r=null;h.eventPhase=0;for(var s=0,t=q.length;t>s;s++){var u=q[s];if(a=u.target,h.isImmediatePropagationStopped())break;r==a&&h.isPropagationStopped()?u.callback.call(d,h):(u.callback.call(d,h),r=a)}var v=!1;q.length&&(v=h.isImmediatePropagationStopped()||h.isPropagationStopped()),h.eventPhase=1;for(var w=0,x=g.length;x>w;w++){var y=g[w];if(v)break;y.call(d,h)}var z=j.propagations;r=null,h.eventPhase=2;for(var A=0,B=z.length;B>A;A++){var C=z[A];if(a=C.target,h.target=a,v){if(h.isImmediatePropagationStopped()||h.isPropagationStopped())break;C.callback.call(d,h),r=a}else{if(h.isImmediatePropagationStopped())break;if(h.isPropagationStopped()){if(r!=a)break;C.callback.call(d,h)}else C.callback.call(d,h),r=a}}}}},{key:"_fixEvent",value:function(a){var b=this,c=function(){return!0},d=function(){return!1};return a&&a.isPropagationStopped||!function(){a=a?a:{};var e=a.preventDefault,f=a.stopPropagation,g=a.stopImmediatePropagation;if(a.target||(a.target=a.srcElement||document),a.currentTarget||(a.currentTarget=b),a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement,a.preventDefault=function(){e&&e.call(a),a.returnValue=!1,a.isDefaultPrevented=c,a.defaultPrevented=!0},a.isDefaultPrevented=d,a.defaultPrevented=!1,a.stopPropagation=function(){f&&f.call(a),a.cancelBubble=!0,a.isPropagationStopped=c},a.isPropagationStopped=d,a.stopImmediatePropagation=function(){g&&g.call(a),a.isImmediatePropagationStopped=c,a.stopPropagation()},a.isImmediatePropagationStopped=d,null!=a.clientX){var h=document.documentElement,i=document.body;a.pageX=a.clientX+(h&&h.scrollLeft||i&&i.scrollLeft||0)-(h&&h.clientLeft||i&&i.clientLeft||0),a.pageY=a.clientY+(h&&h.scrollTop||i&&i.scrollTop||0)-(h&&h.clientTop||i&&i.clientTop||0)}a.which=a.charCode||a.keyCode}(),a}}]),a}();c.EventDispatcher=r;var s=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return a.name="DisplayObject",a.alpha=1,a._height=0,a._width=0,a.mask=null,a.rotate=0,a.scaleX=1,a.scaleY=1,a.parent=null,a.globalCompositeOperation="",a.x=0,a.y=0,a.parent=null,a.visible=!0,a.aIndex=a.objectIndex=""+e++,a._isSaved=!1,a._matrix=j.identity(),a._observeOffsetProperty(),a._observeTransformProperty(),a}return _inherits(b,a),_createClass(b,[{key:"show",value:function(a){var b=this,c=b.ctx||b.stage.ctx;if(b._matrix=j.identity(),!b.visible||b.alpha<=.001)return!1;if((null!=b.mask&&b.mask.show||b.alpha<1||0!=b.rotate||1!=b.scaleX||1!=b.scaleY||0!=b.x||0!=b.y||""!=b.globalCompositeOperation)&&(b._isSaved=!0,c.save()),null!=b.mask&&b.mask.show&&(b.mask.show(),c.clip()),b.alpha<1&&(c.globalAlpha=b.alpha>1?1:b.alpha),0!=b.x||0!=b.y){var d=b.x,e=b.y;b._matrix.translate(d,e),c.translate(d,e)}if(0!=b.rotate){var g=b.rotate;b._matrix.rotate(g),c.rotate(f.deg2rad(g))}if(1!=b.scaleX||1!=b.scaleY){var h=b.scaleX,i=b.scaleY;b._matrix.scale(h,i),c.scale(h,i)}return b._matrix.multi(a),!0}},{key:"dispose",value:function(){var a=this,b=f.keys(a._handlers);a.off(b)}},{key:"_getWidth",value:function(){return this._width}},{key:"_getHeight",value:function(){return this._height}},{key:"_observeOffsetProperty",value:function(){for(var a=this,b=[{key:"width",method:"_getWidth"},{key:"height",method:"_getHeight"}],c=function(c,d){var e=b[d];Object.defineProperty(a,e.key,{get:function(){return a[e.method].call(a)}})},d=0,e=b.length;e>d;d++)c(e,d)}},{key:"_observeTransformProperty",value:function(){for(var a=this,b=[{key:"x",method:"translate",args:function(b){return[b,a.y]}},{key:"y",method:"translate",args:function(b){return[a.x,b]}},{key:"rotate",method:"rotate",args:function(a){return[a]}},{key:"scaleX",method:"scale",args:function(b){return[b,a.scaleY]}},{key:"scaleY",method:"scale",args:function(b){return[a.scaleX,b]}}],c=function(c,d){var e=b[d],f=a[e.key];Object.defineProperty(a,e.key,{set:function(b){f=b,a._matrix[e.method].apply(a._matrix,e.args(b))},get:function(){return f}})},d=0,e=b.length;e>d;d++)c(e,d)}}]),b}(r);c.DisplayObject=s;var t=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return a.name="InteractiveObject",a}return _inherits(b,a),_createClass(b,[{key:"on",value:function(a,c,d){var e=this,g=a.toUpperCase(),h=-1!=f.inArray(g,l.nameList),i=-1!=f.inArray(g,o.nameList);(h||i)&&(h?l.add(a,e):i&&o.add(a,e),_get(Object.getPrototypeOf(b.prototype),"on",this).call(this,a,c,d))}},{key:"off",value:function(a,c){var d=this,e=(a.toUpperCase(),-1!=f.inArray(a,l.nameList)),g=-1!=f.inArray(a,KeyBoardEvent.nameList);(e||g)&&(e?l.remove(a,d):g&&KeyBoardEvent.remove(a,d),_get(Object.getPrototypeOf(b.prototype),"off",this).call(this,a,c))}}]),b}(s);c.InteractiveObject=t;var u=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return a.name="DisplayObjectContainer",a._childList=[],a}return _inherits(b,a),_createClass(b,[{key:"addChild",value:function(a){var b=this;if(a instanceof s){var c=-1==f.inArray(a,b._childList,function(a,b){return a.aIndex==b.aIndex});c&&(a.parent=b,a.stage=a.stage?a.stage:b.stage,a.objectIndex=b.objectIndex+"."+(b._childList.length+1),b._childList.push(a))}}},{key:"removeChild",value:function(a){var b=this;if(a instanceof s)for(var c=b._childList.length-1;c>=0;c--){var d=b._childList[c];if(d.aIndex==a.aIndex){d.parent=null,d.stage=null,Array.prototype.splice.call(b._childList,c,1);break}}}},{key:"getAllChild",value:function(){var a=this;return f.clone(a._childList)}},{key:"getChildAt",value:function(a){var b=this,c=b._childList.length;return Math.abs(a)>c?void 0:(0>a&&(a=c+a),b._childList[a])}},{key:"contains",value:function(a){var b=this;return a instanceof s?-1!=f.inArray(a,b._childList,function(a,b){return a.aIndex==b.aIndex}):void 0}},{key:"show",value:function(a){var c=this;null==a&&(a=j.clone(c._matrix));var d=_get(Object.getPrototypeOf(b.prototype),"show",this).call(this,a);if(d){c instanceof w&&c.graphics&&c.graphics.show&&c.graphics.show(c._matrix);for(var e=0,f=c._childList.length;f>e;e++){var g=c._childList[e];g.show&&g.show(c._matrix)}if(c._isSaved){var h=c.ctx||c.stage.ctx;c._isSaved=!1,h.restore()}}return d}},{key:"_getWidth",value:function(){for(var a=this,b=0,c=a._childList,d=0,e=c.length;e>d;d++){var f=c[d],g=f.width+f.x;b=b>g?b:g}return b}},{key:"_getHeight",value:function(){for(var a=this,b=0,c=a._childList,d=0,e=c.length;e>d;d++){var f=c[d],g=f.height+f.y;b=b>g?b:g}return b}}]),b}(t);c.DisplayObjectContainer=u;var v=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));d.name="Stage",d.domElem=document.getElementById(a),d._width=parseFloat(d.domElem.getAttribute("width"),10),d._height=parseFloat(d.domElem.getAttribute("height"),10),d.ctx=d.domElem.getContext("2d");var e=d._getOffset();return d.x=e.left,d.y=e.top,"function"==typeof c&&c(d),d.initialize(),d}return _inherits(b,a),_createClass(b,[{key:"initialize",value:function(){var a=this;f.each(l.nameList,function(b){b=l[b],r.prototype.on.call(a,a.domElem,b,function(b){a._mouseEvent(b)},!1)}),f.each(o.nameList,function(b){b=o[b],r.prototype.on.call(a,document,b,function(b){a._keyboardEvent(b)})},!1),g.add(a),g.start()}},{key:"show",value:function(){var a=this;a.ctx.clearRect(0,0,a._width,a._height),_get(Object.getPrototypeOf(b.prototype),"show",this).call(this)}},{key:"tick",value:function(){var a=this;a.show()}},{key:"addChild",value:function(a){var c=this,d=function(a){a.stage=c,a instanceof w&&a.graphics&&(a.graphics.stage=c,a.graphics.parent=a,a.graphics.objectIndex=a.objectIndex+".0")};if(d(a),a.getAllChild){var e=a.getAllChild();f.each(e,function(a){d(a)})}_get(Object.getPrototypeOf(b.prototype),"addChild",this).call(this,a)}},{key:"isMouseon",value:function(a){return!0}},{key:"_getWidth",value:function(){return this._width}},{key:"_getHeight",value:function(){return this._height}},{key:"_mouseEvent",value:function(a){var b=this,c={x:0,y:0};null!=a.clientX&&(c.x=a.pageX-b.x,c.y=a.pageY-b.y),a.cord=c;var d=a.type,e=l.getTopItem(d,c);e&&e.trigger(d,a)}},{key:"_keyboardEvent",value:function(a){var b=a.type,c=o.getItems(b);c.length&&f.each(c,function(c){c.trigger(b,a)})}},{key:"_getOffset",value:function(){return{top:0,left:0}}}]),b}(u);c.Stage=v;var w=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return a.name="Sprite",a.graphics=null,a}return _inherits(b,a),_createClass(b,[{key:"addChild",value:function(a){a instanceof x||_get(Object.getPrototypeOf(b.prototype),"addChild",this).call(this,a)}},{key:"removeChild",value:function(a){a instanceof x||_get(Object.getPrototypeOf(b.prototype),"removeChild",this).call(this,a)}},{key:"show",value:function(a){var c=this,d=_get(Object.getPrototypeOf(b.prototype),"show",this).call(this,a);if(d&&c._isSaved){var e=c.ctx||c.stage.ctx;c._isSaved=!1,e.restore()}return d}},{key:"isMouseon",value:function(a){return!0}},{key:"_getWidth",value:function(){var a=this,c=a.graphics,d=_get(Object.getPrototypeOf(b.prototype),"_getWidth",this).call(this);if(c){var e=c.x+c.width;d=d>e?d:e}return d}},{key:"_getHeight",value:function(){var a=this,c=a.graphics,d=_get(Object.getPrototypeOf(b.prototype),"_getHeight",this).call(this);if(c){var e=c.x+c.height;d=d>e?d:e}return d}}]),b}(u);c.Sprite=w;var x=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return a.name="Shape",a._showList=[],a._setList=[],a}return _inherits(b,a),_createClass(b,[{key:"on",value:function(){}},{key:"off",value:function(){}},{key:"show",value:function(a){var c=this,d=c._showList,e=_get(Object.getPrototypeOf(b.prototype),"show",this).call(this,a);if(e){for(var f=0,g=d.length;g>f;f++){var h=d[f];"function"==typeof h&&h()}if(c._isSaved){var i=c.ctx||c.stage.ctx;c._isSaved=!1,i.restore()}}return e}},{key:"lineWidth",value:function(a){var b=this;b._showList.push(function(){var c=b.ctx||b.stage.ctx;c.lineWidth=a})}},{key:"strokeStyle",value:function(a){var b=this;b._showList.push(function(){var c=b.ctx||b.stage.ctx;c.strokeStyle=a})}},{key:"stroke",value:function(){var a=this;a._showList.push(function(){var b=a.ctx||a.stage.ctx;b.stroke()})}},{key:"beginPath",value:function(){var a=this;a._showList.push(function(){var b=a.ctx||a.stage.ctx;b.beginPath()})}},{key:"closePath",value:function(){var a=this;a._showList.push(function(){var b=a.ctx||a.stage.ctx;b.closePath()})}},{key:"moveTo",value:function(a,b){var c=this;c._showList.push(function(){var d=c.ctx||c.stage.ctx;d.moveTo(a,b)})}},{key:"lineTo",value:function(a,b){var c=this;c._showList.push(function(){var d=c.ctx||c.stage.ctx;d.lineTo(a,b)})}},{key:"clear",value:function(){var a=this;a._showList=[],a._setList=[]}},{key:"rect",value:function(a,b,c,d){var e=this;e._showList.push(function(){e.ctx||e.stage.ctx;e.stage.ctx.rect(a,b,c,d)}),e._setList.push({type:"rect",area:[a,b,c,d]})}},{key:"fillStyle",value:function(a){var b=this;b._showList.push(function(){var c=b.ctx||b.stage.ctx;c.fillStyle=a})}},{key:"fill",value:function(){var a=this;a._showList.push(function(){var b=a.ctx||a.stage.ctx;b.fill()})}},{key:"arc",value:function(a,b,c,d,e,f){var g=this;g._showList.push(function(){var h=g.ctx||g.stage.ctx;h.arc(a,b,c,d,e,f)}),g._setList.push({type:"arc",area:[a,b,c,d,e,f]})}},{key:"drawArc",value:function(a,b,c,d,e){var f=this;f._showList.push(function(){var g=f.ctx||f.stage.ctx;g.beginPath(),g.arc(c[0],c[1],c[2],c[3],c[4],c[5]),d&&(g.fillStyle=e,g.fill()),g.lineWidth=a,g.strokeStyle=b,g.stroke()}),f._setList.push({type:"arc",area:c})}},{key:"drawRect",value:function(a,b,c,d,e){var f=this;f._showList.push(function(){var g=f.ctx||f.stage.ctx;g.beginPath(),g.rect(c[0],c[1],c[2],c[3]),d&&(g.fillStyle=e,g.fill()),g.lineWidth=a,g.strokeStyle=b,g.stroke()}),f._setList.push({type:"rect",area:c})}},{key:"drawVertices",value:function(a,b,c,d,e){var f=this,g=c.length;3>g||(f._showList.push(function(){var h=f.ctx||f.stage.ctx;for(h.beginPath(),h.moveTo(c[0][0],c[0][1]),i=1;i<g;i++){var j=c[i];h.lineTo(j[0],j[1])}h.lineTo(c[0][0],c[0][1]),d&&(h.fillStyle=e,h.fill()),h.lineWidth=a,h.strokeStyle=b,h.closePath(),h.stroke()}),f._setList.push({type:"vertices",area:c}))}},{key:"drawLine",value:function(a,b,c){var d=this;d._showList.push(function(){var e=d.ctx||d.stage.ctx;e.beginPath(),e.moveTo(c[0],c[1]),e.lineTo(c[2],c[3]),e.lineWidth=a,e.strokeStyle=b,e.closePath(),e.stroke()})}},{key:"lineStyle",value:function(a,b,c){var d=this;c&&(d.alpha=c),d._showList.push(function(){var c=d.ctx||d.stage.ctx;c.lineWidth=a,c.strokeStyle=b})}},{key:"add",value:function(a){var b=this;b._showList.push(function(){a.call(b)})}},{key:"isMouseon",value:function(a){return!1}},{key:"_getWidth",value:function(){return this._width}},{key:"_getHeight",value:function(){return this._height}}]),b}(s);c.Shape=x,a.Moco=c}(window,void 0);